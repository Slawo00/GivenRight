name: Supabase DB Push

on:
  push:
    branches: [ "master" ]  # Using master (not main)
    paths:
      - "supabase/**"
  workflow_dispatch:  # Manual trigger

jobs:
  migrate:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repo
      uses: actions/checkout@v4
      
    - name: Install Supabase CLI
      uses: supabase/setup-cli@v1
      with:
        version: latest
        
    - name: Authenticate Supabase CLI
      run: supabase login --access-token "${{ secrets.SUPABASE_ACCESS_TOKEN }}"
      
    - name: Link project
      run: supabase link --project-ref "${{ secrets.SUPABASE_PROJECT_REF }}"
      
    - name: Push migrations
      env:
        SUPABASE_DB_URL: ${{ secrets.SUPABASE_DB_URL }}
      run: supabase db push
      
    - name: Verify deployment
      run: |
        echo "âœ… Migration deployed successfully"
        echo "ðŸŽ¯ personality_fit_score should now show 20 instead of 0"